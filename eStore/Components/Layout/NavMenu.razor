@using eStore.Components.Layout
@using eStore.Components.Services
@inject NavigationManager NavigationManager
@inject SessionService SessionService

@code {
    [CascadingParameter] private MainLayout Layout { get; set; } = null!;

    private bool IsAdmin => AuthHelper.IsAdmin(Layout.UserSession);
    private string DisplayName => AuthHelper.GetDisplayName(Layout.UserSession);

    private void HandleLogout()
    {
        Layout.SetUserSession(null);
        SessionService.ClearUserSession();
        NavigationManager.NavigateTo("/", true);
    }
}

<nav class="navbar navbar-dark shadow-sm">
    <div class="container-fluid">
        <div class="row w-100 g-0">
            <!-- Left section - Brand -->
            <div class="col-4 d-flex align-items-center">
                <a class="navbar-brand text-white fs-4 fw-medium ps-4 m-0" href="">Cửa Hàng Điện Tử FU</a>
            </div>

            <!-- Middle section - Navigation -->
            <div class="col-4 d-flex align-items-center justify-content-center gap-5">
                <NavLink class="nav-link text-white px-3 py-2" href="" Match="NavLinkMatch.All">
                    Trang Chủ
                </NavLink>
                @if (IsAdmin)
                {
                    <NavLink class="nav-link text-white px-3 py-2" href="products">
                        Quản lý Sản Phẩm
                    </NavLink>
                    <NavLink class="nav-link text-white px-3 py-2" href="admin/members">
                        Quản lý Thành Viên
                    </NavLink>
                }
                else if (Layout.UserSession != null)
                {
                    <NavLink class="nav-link text-white px-3 py-2" href="categories">
                        Danh Mục
                    </NavLink>
                }
            </div>

            <!-- Right section - User -->
            <div class="col-4 d-flex align-items-center justify-content-end pe-4">
                @if (Layout.UserSession != null)
                {
                    <NavLink href="/cart" class="btn btn-outline-light me-3 position-relative">
                        <i class="bi bi-cart3 me-1"></i>Giỏ hàng
                    </NavLink>
                    <div class="dropdown">
                        <button class="btn nav-link text-white px-3 py-2 dropdown-toggle" 
                                type="button" 
                                id="userDropdown"
                                data-bs-toggle="dropdown" 
                                aria-expanded="false"
                                style="background: none; border: none;">
                            <i class="bi bi-person-fill me-1"></i>@DisplayName
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                            <li>
                                <a class="dropdown-item" href="/profile">
                                    <i class="bi bi-person me-2"></i>Thông tin cá nhân
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li><button class="dropdown-item" type="button" @onclick="HandleLogout">
                                <i class="bi bi-box-arrow-right me-2"></i>Đăng xuất
                            </button></li>
                        </ul>
                    </div>
                }
                else
                {
                    <NavLink class="btn btn-custom-yellow" href="login">
                        <i class="bi bi-box-arrow-in-right me-1"></i>Đăng nhập / Đăng ký
                    </NavLink>
                }
            </div>
        </div>
    </div>
</nav>

